find_package(FFTW)
message(STATUS "FFTW_FOUND: ${FFTW_FOUND} INCLUDE_DIR: ${FFTW_INCLUDE_DIR} LIBRARIES: ${FFTW_LIBRARIES}")

if (FFTW_FOUND)
  add_definitions(-DHAVE_FFTW3_H=1)
  include_directories(${FFTW_INCLUDE_DIR})
  list(APPEND XTAL_LINK_LIBRARIES ${FFTW_LIBRARIES})
endif ()  
  
##########

include_directories(
  ${CMAKE_SOURCE_DIR}/src
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${CMAKE_BINARY_DIR}/src
  ${Boost_INCLUDE_DIRS}
  )

# Normal C++ source files
SET(XTAL_SRCS
xtal.cpp
CCP4InStream.cpp
CCP4MapReader.cpp
XplorMapReader.cpp
MTZ2MapReader.cpp
DensityMap.cpp
MapMeshRenderer.cpp
MapSurfRenderer.cpp
MapRenderer.cpp
QdfDenMapReader.cpp
QdfDenMapWriter.cpp
BrixMapReader.cpp
  )

##########
# CueMol interface definitions for MCWRAPGEN

SET(XTAL_MCWG_QIFS
DensityMap.qif
MapMeshRenderer.qif
MapSurfRenderer.qif
MapRenderer.qif
MTZ2MapReader.qif
CCP4MapReader.qif
BrixMapReader.qif
  )

# module loader generated by MCWG
SET(XTAL_MODLDR_SRC xtal.moddef)

MCWRAPGEN_CLASS(XTAL_SRCS ${XTAL_MCWG_QIFS})
MCWRAPGEN_MODULE(XTAL_SRCS ${XTAL_MODLDR_SRC} ${XTAL_MCWG_QIFS})

if (WIN32)
  add_definitions(-DXTAL_EXPORTS=1)
endif()

add_library(xtal SHARED ${XTAL_SRCS} ${MCWG_HEADERS})
target_link_libraries(xtal PRIVATE qlib gfx qsys molstr symm surface ${XTAL_LINK_LIBRARIES})

MCWRAPGEN_PYWRAPPERS(xtal)

install(TARGETS xtal
  RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
  LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
  )
