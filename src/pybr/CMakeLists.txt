find_package(Python3 COMPONENTS Interpreter Development REQUIRED)
message(STATUS "Python3_Development_FOUND=${Python3_Development_FOUND}")
message(STATUS "Python: version=${Python3_VERSION} Python3_INCLUDE_DIRS=${Python3_INCLUDE_DIRS} Python3_LIBRARIES=${Python3_LIBRARIES}")

add_definitions(-DHAVE_PYTHON=1)

include_directories(
  ${CMAKE_SOURCE_DIR}/src
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${CMAKE_BINARY_DIR}/src
  ${Boost_INCLUDE_DIRS}
  ${Python3_INCLUDE_DIRS}
  )

# Normal C++ source files
SET(PYBR_SRCS
pybr.cpp
wrapper.cpp
convert.cpp
methodobj.cpp
PythonBridge.cpp
  )

# CueMol interface definitions for MCWRAPGEN
SET(PYBR_MCWG_QIFS
PythonBridge.qif
  )

# module loader generated by MCWG
SET(PYBR_MODLDR_SRC pybr.moddef)

MCWRAPGEN_CLASS(PYBR_SRCS ${PYBR_MCWG_QIFS})
MCWRAPGEN_MODULE(PYBR_SRCS ${PYBR_MODLDR_SRC} ${PYBR_MCWG_QIFS})

if (WIN32)
  add_definitions(-DPYBR_EXPORTS=1)
endif()

SET(PYBR_LINK_LIBRARIES
  pcre
  expat
  qmpng
  qmzlib
  qlib
  gfx
  qsys
  molstr
  molvis
  surface
  molanl
  symm
  xtal
  lwview
  render
  anim
  mdtools
  importers
  Boost::filesystem
  Python3::Python
  )

add_library(pybr SHARED ${PYBR_SRCS})
target_link_libraries(pybr PRIVATE ${PYBR_LINK_LIBRARIES})

add_custom_target(pybr_generate_headers DEPENDS ${MCWG_HEADERS})
add_dependencies(pybr pybr_generate_headers)

install(TARGETS pybr
  RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
  LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
  )
