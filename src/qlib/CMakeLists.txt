
SET(QLIB_LINK_LIBRARIES
  pcre
  expat
  qmzlib
  Boost::filesystem
  Boost::timer
  Boost::thread
  )

include_directories(
  ${CMAKE_SOURCE_DIR}/src
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${CMAKE_BINARY_DIR}/src
  ${Boost_INCLUDE_DIRS}
  )

# Normal C++ source files
SET(QLIB_SRCS
NamedObject.cpp
LMsgLog.cpp
ClassRegistry.cpp
LClass.cpp
LRcObject.cpp
LVariant.cpp
LVarDict.cpp
LPropSupport.cpp
LPropContainer.cpp
LScrObjects.cpp
LScrSmartPtr.cpp
LChar.cpp
LString.cpp
LUnicode.cpp
LThread.cpp
ObjectManager.cpp
Utils.cpp
ArrayIOImpl.cpp
PosixFileStream.cpp
PrintStream.cpp
LineStream.cpp
BinStream.cpp
StringStream.cpp
XmlInStream.cpp
ExpatInStream.cpp
GzipStream.cpp
Base64Stream.cpp
PipeStream.cpp
VectorHelper.cpp
MatrixHelper.cpp
LRegExpr.cpp
LLogEvent.cpp
EventManager.cpp
LDOM2Stream.cpp
LDOM2Tree.cpp
LScrVector4D.cpp
LScrMatrix4D.cpp
LScrQuat.cpp
LScrTime.cpp
LScrRangeSet.cpp
LWrapper.cpp
LDataSrcContainer.cpp
LObjStream3.cpp
LProcMgr.cpp
LPerfMeas.cpp
qlib.cpp
)

#####

if (${LIBLZMA_FOUND})
  list(APPEND QLIB_LINK_LIBRARIES LibLZMA::LibLZMA)
  list(APPEND QLIB_SRCS XzStream.cpp)
endif()

# CueMol interface definitions for MCWRAPGEN
SET(QLIB_MCWG_QIFS
LScrObject.qif
Matrix.qif
Vector.qif
RegExpr.qif
Quat.qif
RangeSet.qif
TimeValue.qif
MsgLog.qif
LScrCallBack.qif
ByteArray.qif
ProcessManager.qif)

# module loader generated by MCWG
SET(QLIB_MODLDR_SRC qlib.moddef)

MCWRAPGEN_CLASS(QLIB_SRCS ${QLIB_MCWG_QIFS})
list(REMOVE_ITEM QLIB_SRCS "${CMAKE_CURRENT_SOURCE_DIR}/LScrObject_wrap.cpp")
# message(STATUS "MCWG src file output ${QLIB_SRCS}")
# message(STATUS "MCWG hdr file output ${MCWG_HEADERS}")

MCWRAPGEN_MODULE(QLIB_SRCS ${QLIB_MODLDR_SRC} ${QLIB_MCWG_QIFS})
# message(STATUS "src file ${QLIB_SRCS}")

if (WIN32)
  add_definitions(-DQLIB_EXPORTS=1)
endif()

add_library(qlib SHARED ${QLIB_SRCS} ${MCWG_HEADERS})
target_link_libraries(qlib PRIVATE ${QLIB_LINK_LIBRARIES})

MCWRAPGEN_PYWRAPPERS(qlib)

install(TARGETS qlib
  RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
  LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
  )
